<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SM64 Mobile Single Star Records</title>
    <style>
        :root { --bg-color: #121212; --text-color: #e0e0e0; --primary-color: #ffffff; --secondary-color: #b3b3b3; --border-color: #333333; --pending-color: #f39c12; --accent-color: #6200ee; --rejected-color: #e74c3c; }
        body { background-color: var(--bg-color); color: var(--text-color); font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif; margin: 0; padding: 1rem; }
        header { text-align: center; border-bottom: 1px solid var(--border-color); padding-bottom: 1rem; margin-bottom: 1.5rem; }
        h1, h2, h3 { color: var(--primary-color); }
        nav { margin-top: 1rem; display: flex; justify-content: center; gap: 1.5rem; flex-wrap: wrap; }
        nav a, .action-button { color: var(--secondary-color); text-decoration: none; font-weight: bold; cursor: pointer; }
        nav a:hover, .action-button:hover { color: var(--primary-color); }
        main { max-width: 900px; margin: 0 auto; }
        .grid-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem; }
        .card { background-color: #1e1e1e; border: 1px solid var(--border-color); border-radius: 8px; padding: 1.5rem; text-align: center; cursor: pointer; transition: transform 0.2s; }
        .card:hover { transform: translateY(-5px); }
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 0.75rem; text-align: left; border-bottom: 1px solid var(--border-color); }
        .mod-actions { display: flex; gap: 5px; align-items: center; white-space: nowrap; }
        .mod-actions button { background: none; border: 1px solid var(--border-color); color: var(--text-color); cursor: pointer; padding: 4px 8px; border-radius: 4px; font-size: 1rem; line-height: 1; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); justify-content: center; align-items: center; }
        .modal-content { background-color: #2a2a2a; padding: 2rem; border-radius: 8px; width: 90%; max-width: 500px; position: relative; max-height: 90vh; overflow-y: auto; }
        .close-btn { position: absolute; top: 10px; right: 15px; font-size: 1.5rem; cursor: pointer; }
        form label { display: block; margin-top: 1rem; }
        form input, form select, form button { width: 100%; padding: 0.75rem; margin-top: 0.5rem; border-radius: 4px; border: 1px solid var(--border-color); background-color: #333; color: var(--text-color); box-sizing: border-box; }
        form button { background-color: var(--accent-color); font-weight: bold; cursor: pointer; }
        form button:disabled { background-color: #555; cursor: not-allowed; }
        .loader { text-align: center; font-size: 1.2em; padding: 2rem; }
        .breadcrumb { margin-bottom: 1rem; font-size: 1.1em; }
        .breadcrumb a { color: var(--secondary-color); }
        .breadcrumb span { color: var(--primary-color); }
        #mod-queue-container td { vertical-align: middle; }
        .wr-list { font-size: 0.9em; color: var(--secondary-color); list-style-type: none; padding-left: 0; }

        @media (max-width: 600px) {
            body { padding: 0.5rem; }
            h1 { font-size: 1.5rem; }
            h2 { font-size: 1.3rem; }
            .card h3 { font-size: 1.1rem; }
            td, th { padding: 0.5rem; }
        }
    </style>
</head>
<body>
    <header>
        <h1>SM64 Mobile - Single Star Records</h1>
        <nav>
            <a href="#home">Courses</a>
            <a href="#worldrecords">World Records</a>
            <span id="mod-queue-link-container"></span>
        </nav>
        <div id="user-actions" style="margin-top: 1rem;">
            <a class="action-button" onclick="openSubmissionModal()">Submit Run</a>
            <span style="color: var(--border-color); margin: 0 10px;">|</span>
            <span id="moderator-auth-section"></span>
        </div>
    </header>
    <main id="app-container"></main>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        // ==============================================================================
        // --- 1. CONFIG & APP STATE ---
        // ==============================================================================
        const firebaseConfig = {
            apiKey: "AIzaSyCHGM4Bw4w-3SM3ScVCLnLhcCI0ISTB7S0",
            authDomain: "sm64-mobile-leaderboard.firebaseapp.com",
            projectId: "sm64-mobile-leaderboard",
            storageBucket: "sm64-mobile-leaderboard.firebasestorage.app",
            messagingSenderId: "474371344168",
            appId: "1:474371344168:web:a888b644a2a0b04ec9f21d"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const appContainer = document.getElementById('app-container');
        const appState = {
            isModerator: false,
            coursesCache: [],
            starsCache: {},
            currentListener: null,
            password: "sm64"
        };

        // ==============================================================================
        // --- 2. ROUTER & NAVIGATION ---
        // ==============================================================================
        function router() {
            if (appState.currentListener) {
                appState.currentListener();
                appState.currentListener = null;
            }

            const hash = window.location.hash || '#home';
            if (hash === '#home') {
                showCoursesPage();
            } else if (hash.startsWith('#course/')) {
                const courseId = hash.substring('#course/'.length);
                showStarsPage(courseId);
            } else if (hash.startsWith('#star/')) {
                const [courseId, starId] = hash.substring('#star/'.length).split('/');
                showLeaderboard(courseId, starId);
            } else if (hash === '#modqueue') {
                showModQueuePage();
            } else if (hash === '#worldrecords') {
                showWorldRecordsPage();
            } else {
                window.location.hash = '#home';
            }
        }
        
        // ==============================================================================
        // --- 3. RENDER FUNCTIONS ---
        // ==============================================================================
        function renderLoader(message) { appContainer.innerHTML = `<div class="loader">${message}</div>`; }
        function renderError(message) { appContainer.innerHTML = `<h2>${message}</h2>`; }

        async function loadCourses() {
            if (appState.coursesCache.length > 0) return appState.coursesCache;
            try {
                const snapshot = await db.collection('courses').orderBy('order').get();
                appState.coursesCache = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                return appState.coursesCache;
            } catch (error) { console.error(error); renderError("Error connecting to the database."); return []; }
        }

        async function loadStarsForCourse(courseId) {
            if (appState.starsCache[courseId]) return appState.starsCache[courseId];
             try {
                const snapshot = await db.collection('courses').doc(courseId).collection('stars').orderBy('order').get();
                const stars = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                appState.starsCache[courseId] = stars;
                return stars;
            } catch (error) { console.error(error); renderError("Could not load stars for this course."); return []; }
        }
        
        async function showCoursesPage() {
            renderLoader("Loading Courses...");
            const courses = await loadCourses();
            if (courses.length === 0) {
                renderError('No courses found. Please clear the DB and run `seedDatabase()` in the console (F12).');
                return;
            }
            appContainer.innerHTML = `
                <h2>Select a Course</h2>
                <div class="grid-container">
                    ${courses.map(course => `
                        <div class="card" onclick="window.location.hash='#course/${course.id}'">
                            <h3>${course.name}</h3>
                        </div>
                    `).join('')}
                </div>`;
        }
        
        async function showStarsPage(courseId) {
            renderLoader("Loading Stars...");
            await loadCourses();
            const course = appState.coursesCache.find(c => c.id === courseId);
            if (!course) { window.location.hash = '#home'; return; }

            const stars = await loadStarsForCourse(courseId);
            appContainer.innerHTML = `
                <div class="breadcrumb"><a href="#home">Courses</a> / <span>${course.name}</span></div>
                <h2>Select a Star</h2>
                <div class="grid-container">
                    ${stars.map(star => `
                        <div class="card" onclick="window.location.hash='#star/${course.id}/${star.id}'">
                            <h3>${star.name}</h3>
                        </div>
                    `).join('')}
                </div>`;
        }

        async function showLeaderboard(courseId, starId) {
            renderLoader("Loading Leaderboard...");
            await loadCourses();
            await loadStarsForCourse(courseId);
            const course = appState.coursesCache.find(c => c.id === courseId);
            const star = appState.starsCache[courseId]?.find(s => s.id === starId);

            if (!course || !star) { window.location.hash = '#home'; return; }

            const runsCollection = db.collection('courses').doc(courseId).collection('stars').doc(starId).collection('runs')
                .where('status', '==', 'verified').orderBy('time_numeric');

            appState.currentListener = runsCollection.onSnapshot(snapshot => {
                const runs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                appContainer.innerHTML = `
                    <div class="breadcrumb">
                        <a href="#home">Courses</a> / <a href="#course/${course.id}">${course.name}</a> / <span>${star.name}</span>
                    </div>
                    <h2>${star.name} Leaderboard</h2>
                    <div class="table-container">
                        <table>
                            <thead><tr><th>#</th><th>Runner</th><th>Time</th><th>Date</th><th>Video</th>${appState.isModerator ? '<th>Actions</th>' : ''}</tr></thead>
                            <tbody>
                            ${runs.map((run, index) => {
                                const runDate = run.date ? new Date(run.date.replace(/-/g, '\/')).toLocaleDateString() : 'N/A';
                                return `<tr>
                                    <td>${index + 1}</td>
                                    <td>${run.runner}</td>
                                    <td>${run.time_str}</td>
                                    <td>${runDate}</td>
                                    <td><a href="${run.videoLink}" target="_blank" rel="noopener noreferrer">Link</a></td>
                                    ${appState.isModerator ? `
                                        <td><div class="mod-actions">
                                            <button onclick="openEditModal('${courseId}', '${starId}', '${run.id}')" title="Edit">✏️</button>
                                            <button onclick="deleteRun('${courseId}', '${starId}', '${run.id}')" title="Delete">🗑️</button>
                                        </div></td>` : ''}
                                </tr>`;
                            }).join('') || '<tr><td colspan="6">No verified runs submitted yet.</td></tr>'}
                            </tbody>
                        </table>
                    </div>`;
            }, error => {
                console.error("Error fetching leaderboard:", error);
                renderError("Failed to load leaderboard.");
            });
        }
        
        async function showModQueuePage() {
            if (!appState.isModerator) {
                window.location.hash = '#home';
                return;
            }
            renderLoader("Loading Moderation Queue...");
            await loadCourses();

            try {
                const pendingRunsSnapshot = await db.collectionGroup('runs').where('status', '==', 'pending').get();
                const pendingRuns = pendingRunsSnapshot.docs.map(doc => {
                    const path = doc.ref.path.split('/');
                    return {
                        id: doc.id,
                        courseId: path[1],
                        starId: path[3],
                        ...doc.data()
                    };
                });

                for (const run of pendingRuns) {
                    await loadStarsForCourse(run.courseId);
                }

                appContainer.innerHTML = `
                    <h2>Moderation Queue</h2>
                    <div id="mod-queue-container" class="table-container">
                        <table>
                            <thead><tr><th>Runner</th><th>Course / Star</th><th>Time</th><th>Date</th><th>Video</th><th>Actions</th></tr></thead>
                            <tbody>
                                ${pendingRuns.map(run => {
                                    const course = appState.coursesCache.find(c => c.id === run.courseId);
                                    const star = appState.starsCache[run.courseId]?.find(s => s.id === run.starId);
                                    const runDate = run.date ? new Date(run.date.replace(/-/g, '\/')).toLocaleDateString() : 'N/A';
                                    return `
                                        <tr>
                                            <td>${run.runner}</td>
                                            <td>${course?.name || '...'} / ${star?.name || '...'}</td>
                                            <td>${run.time_str}</td>
                                            <td>${runDate}</td>
                                            <td><a href="${run.videoLink}" target="_blank">Link</a></td>
                                            <td><div class="mod-actions">
                                                <button onclick="updateRunStatus('${run.courseId}', '${run.starId}', '${run.id}', 'verified')" title="Verify">✅</button>
                                                <button onclick="updateRunStatus('${run.courseId}', '${run.starId}', '${run.id}', 'rejected')" title="Reject">❌</button>
                                                <button onclick="openEditModal('${run.courseId}', '${run.starId}', '${run.id}')" title="Edit">✏️</button>
                                                <button onclick="deleteRun('${run.courseId}', '${run.starId}', '${run.id}')" title="Delete">🗑️</button>
                                            </div></td>
                                        </tr>`;
                                }).join('') || '<tr><td colspan="6">The moderation queue is empty.</td></tr>'}
                            </tbody>
                        </table>
                    </div>`;
            } catch (error) {
                console.error("Error loading mod queue:", error);
                renderError("Failed to load moderation queue. You may need to create a Firestore index. Check the console (F12) for an error message with a link to create it.");
            }
        }
        
        async function showWorldRecordsPage() {
            renderLoader("Calculating World Records...");
            try {
                await loadCourses();
                const allRunsSnapshot = await db.collectionGroup('runs').where('status', '==', 'verified').get();
                
                const stars = {};
                allRunsSnapshot.forEach(doc => {
                    const run = doc.data();
                    const path = doc.ref.path.split('/');
                    const key = `${path[1]}/${path[3]}`;
                    if (!stars[key]) stars[key] = { runs: [], courseId: path[1], starId: path[3] };
                    stars[key].runs.push(run);
                });

                const wrData = {};
                for (const key in stars) {
                    const starInfo = stars[key];
                    if (starInfo.runs.length > 0) {
                        starInfo.runs.sort((a, b) => a.time_numeric - b.time_numeric);
                        const wrHolder = starInfo.runs[0].runner;
                        
                        await loadStarsForCourse(starInfo.courseId);
                        const starName = appState.starsCache[starInfo.courseId]?.find(s => s.id === starInfo.starId)?.name || starInfo.starId;

                        if (!wrData[wrHolder]) {
                            wrData[wrHolder] = { count: 0, stars: [] };
                        }
                        wrData[wrHolder].count++;
                        wrData[wrHolder].stars.push(starName);
                    }
                }

                const sortedWRs = Object.entries(wrData).sort((a, b) => b[1].count - a[1].count);

                appContainer.innerHTML = `
                    <h2>World Records Tally</h2>
                    <div class="table-container">
                        <table>
                            <thead><tr><th>#</th><th>Runner</th><th>WRs</th><th>Stars</th></tr></thead>
                            <tbody>
                                ${sortedWRs.map(([runner, data], index) => `
                                    <tr>
                                        <td>${index + 1}</td>
                                        <td>${runner}</td>
                                        <td>${data.count}</td>
                                        <td><ul class="wr-list">${data.stars.map(s => `<li>${s}</li>`).join('')}</ul></td>
                                    </tr>
                                `).join('') || '<tr><td colspan="4">No world records found.</td></tr>'}
                            </tbody>
                        </table>
                    </div>
                `;
            } catch (error) {
                console.error("Error calculating world records:", error);
                renderError("Failed to calculate world records.");
            }
        }
        
        // ==============================================================================
        // --- 4. ACTIONS & MODERATION ---
        // ==============================================================================
        function updateModeratorUI(isLoggedIn) {
            appState.isModerator = isLoggedIn;
            const modSection = document.getElementById('moderator-auth-section');
            const modQueueLink = document.getElementById('mod-queue-link-container');

            if (isLoggedIn) {
                modSection.innerHTML = `<a class="action-button" onclick="logoutModerator()">Logout</a>`;
                modQueueLink.innerHTML = `<a href="#modqueue">Moderation Queue</a>`;
            } else {
                modSection.innerHTML = `<a class="action-button" onclick="loginModerator()">Moderator Login</a>`;
                modQueueLink.innerHTML = '';
            }
            router();
        }

        function loginModerator() {
            const pass = prompt("Enter moderator password:");
            if (pass === appState.password) {
                alert("Login successful!");
                updateModeratorUI(true);
            } else if (pass) {
                alert("Incorrect password.");
            }
        }

        function logoutModerator() {
            updateModeratorUI(false);
        }

        function openModal(modalId) { document.getElementById(modalId).style.display = 'flex'; }
        function closeModal(modalId) { document.getElementById(modalId).style.display = 'none'; }
        
        async function openSubmissionModal() {
            const courses = await loadCourses();
            const courseSelect = document.getElementById('course-select');
            const starSelect = document.getElementById('star-select');
            
            courseSelect.innerHTML = '<option value="">-- Select a Course --</option>' + courses.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
            starSelect.innerHTML = '<option value="">-- Select a Course First --</option>';
            starSelect.disabled = true;

            courseSelect.onchange = async () => {
                const courseId = courseSelect.value;
                if (!courseId) {
                    starSelect.innerHTML = '<option value="">-- Select a Course First --</option>';
                    starSelect.disabled = true;
                    return;
                }
                const stars = await loadStarsForCourse(courseId);
                starSelect.innerHTML = '<option value="">-- Select a Star --</option>' + stars.map(s => `<option value="${s.id}">${s.name}</option>`).join('');
                starSelect.disabled = false;
            };
            
            openModal('submission-modal');
        }

        async function openEditModal(courseId, starId, runId) {
            if (!appState.isModerator) return;
            try {
                const runDoc = await db.collection('courses').doc(courseId).collection('stars').doc(starId).collection('runs').doc(runId).get();
                if (!runDoc.exists) {
                    alert("Run not found!");
                    return;
                }
                const runData = runDoc.data();
                
                document.getElementById('edit-run-id').value = runId;
                document.getElementById('edit-course-id').value = courseId;
                document.getElementById('edit-star-id').value = starId;
                document.getElementById('edit-runner').value = runData.runner;
                document.getElementById('edit-time').value = runData.time_str;
                document.getElementById('edit-date').value = runData.date;
                document.getElementById('edit-videoLink').value = runData.videoLink;
                
                openModal('edit-run-modal');
            } catch(error) {
                console.error("Error opening edit modal:", error);
                alert("Could not load run data for editing.");
            }
        }

        function parseTimeToNumeric(timeStr) {
            if (String(timeStr).includes(':')) {
                const parts = String(timeStr).split(':').map(Number);
                if (parts.length === 2) return (parts[0] * 60) + parts[1];
                if (parts.length === 3) return (parts[0] * 3600) + (parts[1] * 60) + parts[2];
            }
            return parseFloat(timeStr) || Infinity;
        }

        async function handleRunSubmission(event) {
            event.preventDefault();
            const form = document.getElementById('submission-form');
            const submitButton = document.getElementById('submit-run-button');
            submitButton.disabled = true;
            submitButton.textContent = 'Submitting...';

            const courseId = form['course-select'].value;
            const starId = form['star-select'].value;
            const runnerName = form.runner.value.trim();
            const timeStr = form.time.value;
            
            const runData = {
                runner: runnerName,
                time_str: timeStr,
                time_numeric: parseTimeToNumeric(timeStr),
                date: form.date.value,
                videoLink: form.videoLink.value,
                status: 'pending'
            };

            const runsRef = db.collection('courses').doc(courseId).collection('stars').doc(starId).collection('runs');
            
            try {
                const existingRunSnapshot = await runsRef.where('runner', '==', runnerName).where('status', '==', 'verified').limit(1).get();

                if (!existingRunSnapshot.empty) {
                    const existingTime = existingRunSnapshot.docs[0].data().time_numeric;
                    if (runData.time_numeric >= existingTime) {
                        alert("Submission failed: Your new time must be faster than your currently verified record.");
                        submitButton.disabled = false;
                        submitButton.textContent = 'Submit Run';
                        return;
                    }
                }
                
                await runsRef.add(runData);
                alert("Run submitted for moderation!");
                closeModal('submission-modal');
                form.reset();
            } catch (error) {
                alert("An error occurred during submission.");
                console.error("Run submission error:", error);
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = 'Submit Run';
            }
        }

        async function handleRunUpdate(event) {
            event.preventDefault();
            if (!appState.isModerator) return;
            const form = event.target;
            const button = form.querySelector('button');
            button.disabled = true;
            button.textContent = 'Updating...';

            const runId = form['edit-run-id'].value;
            const courseId = form['edit-course-id'].value;
            const starId = form['edit-star-id'].value;
            const timeStr = form['edit-time'].value;
            
            const updatedData = {
                runner: form['edit-runner'].value,
                time_str: timeStr,
                time_numeric: parseTimeToNumeric(timeStr),
                date: form['edit-date'].value,
                videoLink: form['edit-videoLink'].value
            };

            try {
                await db.collection('courses').doc(courseId).collection('stars').doc(starId).collection('runs').doc(runId).update(updatedData);
                alert("Run updated successfully!");
                closeModal('edit-run-modal');
                router();
            } catch(error) {
                console.error("Run update error:", error);
                alert("Failed to update run.");
            } finally {
                button.disabled = false;
                button.textContent = 'Update Run';
            }
        }

        async function updateRunStatus(courseId, starId, runId, newStatus) {
            if (!appState.isModerator) return;
            if (!confirm(`Are you sure you want to ${newStatus} this run?`)) return;

            try {
                await db.collection('courses').doc(courseId).collection('stars').doc(starId).collection('runs').doc(runId).update({
                    status: newStatus
                });
                alert(`Run has been ${newStatus}.`);
                router();
            } catch (error) {
                console.error(`Failed to ${newStatus} run:`, error);
                alert(`An error occurred.`);
            }
        }

        async function deleteRun(courseId, starId, runId) {
            if (!appState.isModerator) return;
            if (!confirm("Are you sure you want to permanently delete this run? This cannot be undone.")) return;

            try {
                await db.collection('courses').doc(courseId).collection('stars').doc(starId).collection('runs').doc(runId).delete();
                alert("Run deleted successfully.");
                router();
            } catch (error) {
                console.error("Failed to delete run:", error);
                alert("An error occurred while deleting the run.");
            }
        }
        
        // ==============================================================================
        // --- 5. SEED FUNCTION (FOR DEV CONSOLE USE) ---
        // ==============================================================================
        async function seedDatabase() {
            console.log("This will ERASE the 'courses' collection. Please ensure you have manually deleted the collection in Firebase Console first for a clean seed.");
            if (!confirm("This will overwrite existing data. Are you sure you want to continue?")) return;

            const seedData = {
                courses: [
                    { id: "bob", name: "Bob-omb Battlefield", order: 1, stars: [
                        { id: "big_bob_omb_on_the_summit", name: "Big Bob-Omb on the Summit", order: 1, runs: [] },
                        { id: "footrace_with_koopa_the_quick", name: "Footrace with Koopa the Quick", order: 2, runs: [] },
                        { id: "shoot_to_the_island_in_the_sky", name: "Shoot to the Island in the Sky", order: 3, runs: [] },
                        { id: "find_the_8_red_coins", name: "Find the 8 Red Coins", order: 4, runs: [] },
                        { id: "mario_wings_to_the_sky", name: "Mario Wings to the Sky", order: 5, runs: [] },
                        { id: "behind_chain_chomps_gate", name: "Behind Chain Chomp's Gate", order: 6, runs: [
                            { runner: "Cappu", time: "12.50", date: "2024-08-14", videoLink: "https://youtu.be/xk1TlvjUSZA" },
                            { runner: "Chillo", time: "13.73", date: "2024-08-11", videoLink: "https://www.youtube.com/watch?v=RXf4cT7enEw" }
                        ]},
                        { id: "bob_100_coins", name: "BoB 100 Coins", order: 7, runs: [] }
                    ]},
                    { id: "wf", name: "Whomp's Fortress", order: 2, stars: [
                        { id: "chip_off_whomps_block", name: "Chip off Whomp's Block", order: 1, runs: [] },
                        { id: "to_the_top_of_the_fortress", name: "To the Top of the Fortress", order: 2, runs: [] },
                        { id: "shoot_into_the_wild_blue", name: "Shoot into the Wild Blue", order: 3, runs: [
                            { runner: "stEv", time: "9.96", date: "2024-10-04", videoLink: "https://youtu.be/BAEcgp-oHm4" },
                            { runner: "SpeedVortex", time: "10.36", date: "2024-08-18", videoLink: "https://youtu.be/evH4OeyX46k?si=y3vpS97z65A4q8ve" }
                        ]},
                        { id: "red_coins_on_the_floating_isle", name: "Red Coins on the Floating Isle", order: 4, runs: [] },
                        { id: "fall_onto_the_caged_island", name: "Fall onto the Caged Island", order: 5, runs: [
                            { runner: "stEv", time: "11.53", date: "2024-10-04", videoLink: "https://youtu.be/jVYhy01ph7c?si=zNI99DDmTFXKsdxT" },
                            { runner: "Major", time: "11.76", date: "2024-08-11", videoLink: "https://youtu.be/hEQ_Gcmw_t0?si=A0FrpNb1LTWLwnrc" }
                        ]},
                        { id: "blast_away_the_wall", name: "Blast Away the Wall", order: 6, runs: [
                            { runner: "Cabinet_Pie", time: "8.23", date: "2024-06-17", videoLink: "https://youtu.be/SXzn4LDffzs?si=FTRRNUmQ4XmZDXnP" },
                            { runner: "Nisi Sm64", time: "8.43", date: "2021-05-15", videoLink: "https://youtu.be/lHx6lb3BkB8?si=F5PJNNV-H2ZCQyIp" },
                            { runner: "Sebastian", time: "9.36", date: "2024-09-23", videoLink: "https://youtu.be/g2wSHC0_9Tg?si=Noq4O2JnWGc2ce0t" }
                        ]},
                        { id: "wf_100_coins", name: "WF 100 Coins", order: 7, runs: [] }
                    ]},
                    { id: "jrb", name: "Jolly Roger Bay", order: 3, stars: [
                        { id: "plunder_in_the_sunken_ship", name: "Plunder in the Sunken Ship", order: 1, runs: [] },
                        { id: "can_the_eel_come_out_to_play", name: "Can the Eel Come out to Play?", order: 2, runs: [] },
                        { id: "treasure_of_the_ocean_cave", name: "Treasure of the Ocean Cave", order: 3, runs: [
                            { runner: "SpeedVortex", time: "41.80", date: "2024-08-13", videoLink: "https://youtu.be/Q9wAIzBs2Nc?si=2PD_rFQmpnfoi1Yv" },
                            { runner: "Cappu", time: "42.03", date: "2024-08-13", videoLink: "https://youtu.be/96WgYDRoPqc" },
                            { runner: "Nisi Sm64", time: "48.33", date: "2021-03-04", videoLink: "https://www.youtube.com/watch?v=i4qKBOikuZQ&t=41s" }
                        ]},
                        { id: "red_coins_on_the_ship_afloat", name: "Red Coins on the Ship Afloat", order: 4, runs: [
                            { runner: "Cappu", time: "1:01.13", date: "2024-11-08", videoLink: "https://youtu.be/1awEYs2_R-I?si=BGP0ccaj31xPkPWZ" }
                        ]},
                        { id: "blast_to_the_stone_pillar", name: "Blast to the Stone Pillar", order: 5, runs: [] },
                        { id: "through_the_jet_stream", name: "Through the Jet Stream", order: 6, runs: [] },
                        { id: "jrb_100_coins", name: "JRB 100 Coins", order: 7, runs: [] }
                    ]},
                    { id: "ccm", name: "Cool, Cool Mountain", order: 4, stars: [
                        { id: "slip_slidin_away", name: "Slip Slidin' Away", order: 1, runs: [] },
                        { id: "lil_penguin_lost", name: "Li'l Penguin Lost", order: 2, runs: [] },
                        { id: "big_penguin_race", name: "Big Penguin Race", order: 3, runs: [] },
                        { id: "frosty_slide_for_8_red_coins", name: "Frosty Slide for 8 Red Coins", order: 4, runs: [
                            { runner: "Cappu", time: "41.66", date: "2024-08-13", videoLink: "https://youtu.be/29-rcvux468" },
                            { runner: "Major", time: "43.23", date: "2024-07-27", videoLink: "https://youtube.com/shorts/8Jv5S1Mkl-8?si=lsxD9S7N9MZoP5es" },
                            { runner: "Nisi sm64", time: "54.43", date: "2021-03-18", videoLink: "https://youtu.be/TaasQ943pwE" }
                        ]},
                        { id: "snowmans_lost_his_head", name: "Snowman's Lost his Head", order: 5, runs: [
                            { runner: "SpeedVortex", time: "36.20", date: "2024-08-13", videoLink: "https://youtu.be/NK-pPVOscuE?si=WtCJAgc_hme5mjeU" }
                        ]},
                        { id: "wall_kicks_will_work", name: "Wall Kicks will Work", order: 6, runs: [
                             { runner: "stEv", time: "8.90", date: "2024-10-03", videoLink: "https://youtu.be/8ZujZM-8cQE?si=efs0EXI35YWV8Kge" },
                             { runner: "Cappu", time: "9.53", date: "2024-08-13", videoLink: "https://youtu.be/WRbN50hwMsA" },
                             { runner: "Nisi Sm64", time: "9.83", date: "2021-02-16", videoLink: "https://youtu.be/4ayImJZkCJ4?si=EnDgjspAnHw7UYj2" }
                        ]},
                        { id: "ccm_100_coins", name: "CCM 100 Coins", order: 7, runs: [] }
                    ]},
                    { id: "bbh", name: "Big Boo's Haunt", order: 5, stars: [
                        { id: "go_on_a_ghost_hunt", name: "Go on a Ghost Hunt", order: 1, runs: [] },
                        { id: "ride_big_boos_merry_go_round", name: "Ride Big Boo's Merry-Go-Round", order: 2, runs: [] },
                        { id: "secret_of_the_haunted_books", name: "Secret of the Haunted Books", order: 3, runs: [
                            { runner: "stEv", time: "11.36", date: "2024-10-04", videoLink: "https://youtu.be/Hua2Qfz8r7s?si=DVD2ONnrmALlEnjq" },
                            { runner: "Major", time: "11.53", date: "2024-08-13", videoLink: "https://youtu.be/UP53rC4vtog?si=Dh6AP3We-AMiFHth" },
                            { runner: "Chillo", time: "16.66", date: "2024-08-12", videoLink: "https://youtu.be/IBg2m-tAaT8?si=f-Gb4t5nMwkboGcJ" }
                        ]},
                        { id: "seek_the_8_red_coins", name: "Seek the 8 Red Coins", order: 4, runs: [] },
                        { id: "big_boos_balcony", name: "Big Boo's Balcony", order: 5, runs: [] },
                        { id: "eye_to_eye_in_the_secret_room", name: "Eye to Eye in the Secret Room", order: 6, runs: [] },
                        { id: "bbh_100_coins", name: "BBH 100 Coins", order: 7, runs: [] }
                    ]},
                    { id: "hmc", name: "Hazy Maze Cave", order: 6, stars: [
                        { id: "swimming_beast_in_the_cavern", name: "Swimming Beast in the Cavern", order: 1, runs: [] },
                        { id: "elevate_for_8_red_coins", name: "Elevate for 8 Red Coins", order: 2, runs: [] },
                        { id: "metal_head_mario_can_move", name: "Metal-Head Mario Can Move!", order: 3, runs: [] },
                        { id: "navigating_the_toxic_maze", name: "Navigating the Toxic Maze", order: 4, runs: [] },
                        { id: "a_maze_ing_emergency_exit", name: "A-Maze-ing Emergency Exit", order: 5, runs: [] },
                        { id: "watch_for_rolling_rocks", name: "Watch for Rolling Rocks", order: 6, runs: [] },
                        { id: "hmc_100_coins", name: "HMC 100 Coins", order: 7, runs: [] }
                    ]},
                    { id: "lll", name: "Lethal Lava Land", order: 7, stars: [
                        { id: "boil_the_big_bully", name: "Boil the Big Bully", order: 1, runs: [
                            { runner: "SpeedVortex", time: "20.16", date: "2024-08-13", videoLink: "https://youtu.be/2MXzd8ZzXjA?si=P7sfp2QdGpGaQ_Ew" }
                        ]},
                        { id: "bully_the_bullies", name: "Bully the Bullies", order: 2, runs: [
                            { runner: "SpeedVortex", time: "26.50", date: "2024-08-13", videoLink: "https://youtu.be/mtZTrsUbRns?si=2kJAx2RzhHEeou2R" }
                        ]},
                        { id: "8_coin_puzzle_with_15_pieces", name: "8-Coin Puzzle with 15 Pieces", order: 3, runs: [
                            { runner: "stEv", time: "14.30", date: "2024-10-05", videoLink: "https://youtu.be/1lkjzmiZAfg?si=w_mfLDrA3J1ArZx3" },
                            { runner: "Cappu", time: "14.76", date: "2024-08-12", videoLink: "https://youtu.be/ErXTRMAaFqk" },
                            { runner: "Nisi Sm64", time: "14.80", date: "2024-08-11", videoLink: "https://youtu.be/7o4CzkXcmqs?si=oGV8w3oHY5OGkh8g" },
                            { runner: "Major", time: "15.70", date: "2024-08-11", videoLink: "https://youtu.be/FM74-fMh46E?si=l7cgI0av9OIbPZW6" }
                        ]},
                        { id: "red_hot_log_rolling", name: "Red-Hot Log Rolling", order: 4, runs: [
                            { runner: "Nisi sm64", time: "13.43", date: "2020-12-17", videoLink: "https://youtu.be/i1jXkfIe-Dk?si=H3oPW9K55ggtn-VF" }
                        ]},
                        { id: "hot_foot_it_into_the_volcano", name: "Hot-Foot-It into the Volcano", order: 5, runs: [] },
                        { id: "elevator_tour_in_the_volcano", name: "Elevator Tour in the Volcano", order: 6, runs: [] },
                        { id: "lll_100_coins", name: "LLL 100 Coins", order: 7, runs: [] }
                    ]},
                    { id: "ssl", name: "Shifting Sand Land", order: 8, stars: [
                        { id: "in_the_talons_of_the_big_bird", name: "In the Talons of the Big Bird", order: 1, runs: [] },
                        { id: "shining_atop_the_pyramid", name: "Shining Atop the Pyramid", order: 2, runs: [
                            { runner: "SpeedVortex", time: "6.93", date: "2024-08-17", videoLink: "https://youtu.be/8z5p9iP2J28?si=GAQUeG7rm6p2oN5i" },
                            { runner: "Cabinet_Pie", time: "6.96", date: "2024-04-07", videoLink: "https://youtu.be/ultWB5nUVaE?si=WA_4B3IK0wJLFN2A" },
                            { runner: "Chillo", time: "6.96", date: "2024-08-11", videoLink: "https://youtu.be/-YyDmxaJR8o?si=Iiqj2RI2HjAY2pOJ" }
                        ]},
                        { id: "inside_the_ancient_pyramid", name: "Inside the Ancient Pyramid", order: 3, runs: [
                            { runner: "Nisi Sm64", time: "15.03", date: "2022-06-10", videoLink: "https://youtu.be/g9fNot55y0c?si=lO5Gm0BKVH0vVd-b" },
                            { runner: "Sebastian", time: "19.70", date: "2024-09-23", videoLink: "https://youtu.be/48sGOYYiDBM?si=cSRNuoQK9eGuw4af" }
                        ]},
                        { id: "stand_tall_on_the_four_pillars", name: "Stand Tall on the Four Pillars", order: 4, runs: [] },
                        { id: "free_flying_for_8_red_coins", name: "Free Flying for 8 Red Coins", order: 5, runs: [] },
                        { id: "pyramid_puzzle", name: "Pyramid Puzzle", order: 6, runs: [] },
                        { id: "ssl_100_coins", name: "SSL 100 Coins", order: 7, runs: [] }
                    ]},
                    { id: "ddd", name: "Dire, Dire Docks", order: 9, stars: [
                        { id: "board_bowsers_sub", name: "Board Bowser's Sub", order: 1, runs: [] },
                        { id: "chests_in_the_current", name: "Chests in the Current", order: 2, runs: [] },
                        { id: "pole_jumping_for_red_coins", name: "Pole-Jumping for Red Coins", order: 3, runs: [] },
                        { id: "through_the_jet_stream_ddd", name: "Through the Jet Stream", order: 4, runs: [] },
                        { id: "the_manta_rays_reward", name: "The Manta Ray's Reward", order: 5, runs: [] },
                        { id: "collect_the_caps", name: "Collect the Caps", order: 6, runs: [] },
                        { id: "ddd_100_coins", name: "DDD 100 Coins", order: 7, runs: [] }
                    ]},
                    { id: "sl", name: "Snowman's Land", order: 10, stars: [
                        { id: "snowmans_big_head", name: "Snowman's Big Head", order: 1, runs: [] },
                        { id: "chill_with_the_bully", name: "Chill with the Bully", order: 2, runs: [
                            { runner: "Cabinet_Pie", time: "12.46", date: "2024-08-25", videoLink: "https://www.youtube.com/watch?v=hARdphGmL8I" },
                            { runner: "Nisi sm64", time: "12.96", date: "2024-08-24", videoLink: "https://youtu.be/Ifbr_VPftQE?si=lifaTvmJL7IPioWQ" }
                        ]},
                        { id: "in_the_deep_freeze", name: "In the Deep Freeze", order: 3, runs: [
                            { runner: "stEv", time: "5.56", date: "2024-10-03", videoLink: "https://youtu.be/uUqM3ERHiB0?si=Zgf6y3VefLJx6ZfN" },
                            { runner: "SpeedVortex", time: "5.70", date: "2024-08-14", videoLink: "https://youtu.be/7fC7r_bY3J4?si=_MhOR535y7LhNJr4" },
                            { runner: "Cappu", time: "5.86", date: "2024-08-11", videoLink: "https://youtu.be/rQTjPTqDucU?si=-tbmzqVe_GvXXofl" },
                            { runner: "Chillo", time: "5.86", date: "2024-08-12", videoLink: "https://youtu.be/zLZbLtZUQ0w?si=-5hRP02la90bfbvU" },
                            { runner: "Nisi Sm64", time: "5.93", date: "2024-08-11", videoLink: "https://youtu.be/xmDfiugpOXo?si=JVWpLx4I9FvVtWp9" }
                        ]},
                        { id: "whirl_from_the_freezing_pond", name: "Whirl from the Freezing Pond", order: 4, runs: [] },
                        { id: "shell_shreddin_for_8_red_coins", name: "Shell Shreddin' for 8 Red Coins", order: 5, runs: [] },
                        { id: "into_the_igloo", name: "Into the Igloo", order: 6, runs: [] },
                        { id: "sl_100_coins", name: "SL 100 Coins", order: 7, runs: [] }
                    ]},
                    { id: "wdw", name: "Wet-Dry World", order: 11, stars: [
                        { id: "shocking_arrow_lifts", name: "Shocking Arrow Lifts!", order: 1, runs: [
                            { runner: "Speedvortex", time: "13.73", date: "2024-08-13", videoLink: "https://youtu.be/3GegUaMW6f4?si=1phX1J5ETgVPnDHG" }
                        ]},
                        { id: "top_o_the_town", name: "Top O' The Town", order: 2, runs: [
                            { runner: "Chillo", time: "26.40", date: "2024-08-13", videoLink: "https://youtu.be/Pu0nGTuSz3g?si=Fjc1gKTh0QJTs8fj" }
                        ]},
                        { id: "secrets_in_the_shallows_and_sky", name: "Secrets in the Shallows & Sky", order: 3, runs: [] },
                        { id: "express_elevators_hurry_up", name: "Express Elevators--Hurry Up!", order: 4, runs: [
                             { runner: "SpeedVortex", time: "25.63", date: "2024-08-13", videoLink: "https://youtu.be/AcjU5HmZZFM?si=gzoL53U37f14n4Lt" }
                        ]},
                        { id: "go_to_town_for_red_coins", name: "Go to Town for Red Coins", order: 5, runs: [] },
                        { id: "quick_race_through_downtown", name: "Quick Race through Downtown", order: 6, runs: [] },
                        { id: "wdw_100_coins", name: "WDW 100 Coins", order: 7, runs: [] }
                    ]},
                    { id: "ttm", name: "Tall, Tall Mountain", order: 12, stars: [
                        { id: "scale_the_mountain", name: "Scale the Mountain", order: 1, runs: [
                            { runner: "SpeedVortex", time: "20.86", date: "2024-08-13", videoLink: "https://youtu.be/GaT8k467-q8?si=FSUZd58pItsZx73g" }
                        ]},
                        { id: "mystery_of_the_monkey_cage", name: "Mystery of the Monkey Cage", order: 2, runs: [] },
                        { id: "scary_shrooms_red_coins", name: "Scary 'Shrooms, Red Coins", order: 3, runs: [] },
                        { id: "mysterious_mountainside", name: "Mysterious Mountainside", order: 4, runs: [
                            { runner: "SpeedVortex", time: "7.56", date: "2025-07-05", videoLink: "https://youtu.be/3OmPz3eEb14" }
                        ]},
                        { id: "breathtaking_view_from_bridge", name: "Breathtaking View from Bridge", order: 5, runs: [] },
                        { id: "blast_to_the_lonely_mushroom", name: "Blast to the Lonely Mushroom", order: 6, runs: [
                            { runner: "SpeedVortex", time: "11.23", date: "2024-08-13", videoLink: "https://youtu.be/nXnagxFRno0?si=d-tKNAsxzjA4WG5H" }
                        ]},
                        { id: "ttm_100_coins", name: "TTM 100 Coins", order: 7, runs: [] }
                    ]},
                    { id: "thi", name: "Tiny-Huge Island", order: 13, stars: [
                        { id: "pluck_the_piranha_flower", name: "Pluck the Piranha Flower", order: 1, runs: [
                             { runner: "SpeedVortex", time: "24.20", date: "2024-08-13", videoLink: "https://youtu.be/6fYTMUhKkis?si=9Bw6DGzmIFD7b1ii" }
                        ]},
                        { id: "the_tip_top_of_the_huge_island", name: "The Tip Top of the Huge Island", order: 2, runs: [
                            { runner: "Cappu", time: "20.96", date: "2024-08-11", videoLink: "https://youtu.be/LVIQl0_CXuE?si=jyMpnzYafjY2KC50" }
                        ]},
                        { id: "rematch_with_koopa_the_quick", name: "Rematch with Koopa the Quick", order: 3, runs: [] },
                        { id: "five_itty_bitty_secrets", name: "Five Itty Bitty Secrets", order: 4, runs: [] },
                        { id: "wigglers_red_coins", name: "Wiggler's Red Coins", order: 5, runs: [] },
                        { id: "make_wiggler_squirm", name: "Make Wiggler Squirm", order: 6, runs: [] },
                        { id: "thi_100_coins", name: "THI 100 Coins", order: 7, runs: [] }
                    ]},
                    { id: "ttc", name: "Tick Tock Clock", order: 14, stars: [
                        { id: "roll_into_the_cage", name: "Roll into the Cage", order: 1, runs: [] },
                        { id: "the_pit_and_the_pendulums", name: "The Pit and the Pendulums", order: 2, runs: [] },
                        { id: "get_a_hand", name: "Get a Hand", order: 3, runs: [
                            { runner: "SpeedVortex", time: "8.96", date: "2024-08-13", videoLink: "https://youtu.be/JFZ29wYU--0?si=UP9gyjSu7FfBqnm2" }
                        ]},
                        { id: "stomp_on_the_thwomp", name: "Stomp on the Thwomp", order: 4, runs: [] },
                        { id: "timed_jumps_on_moving_bars", name: "Timed Jumps on Moving Bars", order: 5, runs: [] },
                        { id: "stop_time_for_red_coins", name: "Stop Time for Red Coins", order: 6, runs: [
                            { runner: "Cappu", time: "14.30", date: "2024-08-11", videoLink: "https://youtu.be/yW2_-kILCHI?si=JXdqZNLgVu0qNSxQ" }
                        ]},
                        { id: "ttc_100_coins", name: "TTC 100 Coins", order: 7, runs: [] }
                    ]},
                    { id: "rr", name: "Rainbow Ride", order: 15, stars: [
                        { id: "cruiser_crossing_the_rainbow", name: "Cruiser Crossing the Rainbow", order: 1, runs: [
                            { runner: "Cappu", time: "21.16", date: "2024-08-11", videoLink: "https://youtu.be/9XkQGHd5Yok?si=ZHkKMKMbTCmEO3MY" },
                            { runner: "Nisi Sm64", time: "23.76", date: "2024-08-11", videoLink: "https://youtu.be/nN6AcfpZQw4?si=d7cSnU4TsDpl2poQ" },
                            { runner: "Chillo", time: "31.06", date: "2024-08-11", videoLink: "https://youtu.be/0GkFblHbXFo?si=edrk5CtRiBtdedrl" }
                        ]},
                        { id: "the_big_house_in_the_sky", name: "The Big House in the Sky", order: 2, runs: [
                            { runner: "Cappu", time: "2:03.83", date: "2024-08-13", videoLink: "https://youtu.be/pmwHNLrPi8o" },
                            { runner: "WRandY", time: "2:08.50", date: "2024-02-09", videoLink: "https://b23.tv/zmOucVf" },
                            { runner: "Nisi Sm64", time: "2:10.20", date: "2021-03-04", videoLink: "https://youtu.be/pVmovfdrHCg?si=XfwLqa_HeXbi3Is5" }
                        ]},
                        { id: "coins_amassed_in_a_maze", name: "Coins Amassed in a Maze", order: 3, runs: [
                            { runner: "stEv", time: "23.96", date: "2024-10-03", videoLink: "https://youtu.be/OCXyAUIZ3c0?si=c0hJkloq934wjW2N" },
                            { runner: "Cappu", time: "25.60", date: "2024-08-11", videoLink: "https://youtu.be/uYsY55hiVqc?si=OErkBVq-BPUN1wmq" }
                        ]},
                        { id: "swingin_in_the_breeze", name: "Swingin' in the Breeze", order: 4, runs: [
                            { runner: "Speedvortex", time: "13.86", date: "2024-08-13", videoLink: "https://youtu.be/ywRi4kdg3uE?si=LG6hJb7UJpVQtTzi" },
                            { runner: "Chillo", time: "15.93", date: "2024-08-12", videoLink: "https://youtu.be/7F9zom6vsI4?si=6QL7zDvw8oT7rGAs" }
                        ]},
                        { id: "tricky_triangles", name: "Tricky Triangles!", order: 5, runs: [
                            { runner: "stEv", time: "13.03", date: "2024-10-05", videoLink: "https://youtu.be/37P6VLXTX4w?si=VYpc7PMLzqynH9Tq" },
                            { runner: "Chillo", time: "16.60", date: "2024-08-12", videoLink: "https://youtu.be/WG0XX-MO-Fg?si=GVF3e69PcsIvZHt3" }
                        ]},
                        { id: "somewhere_over_the_rainbow", name: "Somewhere over the Rainbow", order: 6, runs: [] },
                        { id: "rr_100_coins", name: "RR 100 Coins", order: 7, runs: [] }
                    ]},
                    { id: "bowser_stages", name: "Bowser Stages", order: 16, stars: [
                        { id: "bowser_in_the_dark_world_no_reds", name: "Bowser in the Dark World No Reds", order: 1, runs: [
                            { runner: "stEv", time: "27.83", date: "2024-10-04", videoLink: "https://youtu.be/qQS6BGZgTQs?si=XVnJSraXvLiRm7le" }
                        ]},
                        { id: "bowser_in_the_dark_world_reds", name: "Bowser in the Dark World Reds", order: 2, runs: [
                            { runner: "stEv", time: "47.33", date: "2024-10-03", videoLink: "https://youtu.be/_2Z4HtjkqV0?si=A27lvbqQHRbKy3iw" },
                            { runner: "Mack64", time: "47.90", date: "2024-09-01", videoLink: "https://youtu.be/deiGDUoY1tI?si=CPbv_nYDqZ8CDo3Z" },
                            { runner: "Cabinet_Pie", time: "50.30", date: "2024-07-16", videoLink: "https://youtu.be/kyfY6Rw8O_w?si=R1k7PLmaeOO2Ve8P" }
                        ]},
                        { id: "bowser_in_the_fire_sea_no_reds", name: "Bowser in the Fire Sea No Reds", order: 3, runs: [
                             { runner: "stEv", time: "37.33", date: "2024-10-03", videoLink: "https://youtu.be/TinkZuCVE74?si=p677_9gl2aq_dbc0" }
                        ]},
                        { id: "bowser_in_the_fire_sea_reds", name: "Bowser in the Fire Sea Reds", order: 4, runs: [
                            { runner: "stEv", time: "53.30", date: "2024-10-05", videoLink: "https://youtu.be/5IverqtAlPo?si=Rx-xOCmTiEos5IyT" },
                            { runner: "Cappu", time: "1:09.03", date: "2024-08-11", videoLink: "https://youtu.be/NlMNUVJ6SS0?si=P3DTwNs4A5oScSZ7" }
                        ]},
                        { id: "bowser_in_the_sky_no_reds", name: "Bowser in the Sky No Reds", order: 5, runs: [
                             { runner: "Sebastian", time: "48.70", date: "2024-09-21", videoLink: "https://youtu.be/CaUnnUjh3Ns?si=SevzYTW2VkZEZBVn" }
                        ]},
                        { id: "bowser_in_the_sky_reds", name: "Bowser in the Sky Reds", order: 6, runs: [
                            { runner: "Cappu", time: "1:17.36", date: "2024-08-11", videoLink: "https://youtu.be/rOb_OTQeI6o?si=yl7_Cv6Tgb-cfHya" }
                        ]}
                    ]},
                    { id: "secret_stars", name: "Castle Secret Stars", order: 17, stars: [
                        { id: "the_princesss_secret_slide", name: "The Princess's Secret Slide", order: 1, runs: [] },
                        { id: "the_princesss_secret_slide_u21", name: "The Princess's Secret Slide U21", order: 2, runs: [] },
                        { id: "the_secret_aquarium", name: "The Secret Aquarium", order: 3, runs: [] },
                        { id: "tower_of_the_wing_cap", name: "Tower of the Wing Cap", order: 4, runs: [] },
                        { id: "cavern_of_the_metal_cap", name: "Cavern of the Metal Cap", order: 5, runs: [] },
                        { id: "vanish_cap_under_the_moat", name: "Vanish Cap Under the Moat", order: 6, runs: [] },
                        { id: "wing_mario_over_the_rainbow", name: "Wing Mario Over the Rainbow", order: 7, runs: [] }
                    ]}
                ]
            };
            
            try {
                console.log("Starting database seed...");
                const coursesCollection = db.collection('courses');
                
                seedData.courses.forEach(course => {
                    course.stars.forEach(star => {
                        star.runs.forEach(run => {
                            run.time_numeric = parseTimeToNumeric(run.time);
                            run.time_str = run.time;
                            delete run.time;
                            run.status = 'verified';
                        });
                    });
                });

                const addBatch = db.batch();
                for (const course of seedData.courses) {
                    const courseRef = coursesCollection.doc(course.id);
                    addBatch.set(courseRef, { name: course.name, order: course.order });
                    for (const star of course.stars) {
                        const starRef = courseRef.collection('stars').doc(star.id);
                        addBatch.set(starRef, { name: star.name, order: star.order });
                        for (const run of star.runs) {
                            const runRef = starRef.collection('runs').doc();
                            addBatch.set(runRef, run);
                        }
                    }
                }
                await addBatch.commit();
                console.log("DATABASE SEEDING COMPLETE!");
                window.location.reload();
            } catch (error) {
                console.error("SEEDING FAILED:", error);
                alert("Seeding failed. Check the console for details. Make sure the 'courses' collection was manually deleted from Firebase first.");
            }
        }
        
        // ==============================================================================
        // --- 6. INITIALIZATION ---
        // ==============================================================================
        window.addEventListener('hashchange', router);
        document.addEventListener('DOMContentLoaded', () => {
            document.body.insertAdjacentHTML('beforeend', `
                <div id="submission-modal" class="modal">
                    <div class="modal-content">
                        <span class="close-btn" onclick="closeModal('submission-modal')">&times;</span>
                        <h2>Submit New Run</h2>
                        <form id="submission-form" onsubmit="handleRunSubmission(event)">
                            <label for="course-select">Course:</label><select id="course-select" required></select>
                            <label for="star-select">Star:</label><select id="star-select" required disabled></select>
                            <label for="runner">Runner:</label><input type="text" id="runner" required>
                            <label for="time">Time (e.g., 9.96 or 1:01.13):</label><input type="text" id="time" required>
                            <label for="date">Date:</label><input type="date" id="date" required>
                            <label for="videoLink">Video Link:</label><input type="url" id="videoLink" required>
                            <button type="submit" id="submit-run-button">Submit Run</button>
                        </form>
                    </div>
                </div>
                <div id="edit-run-modal" class="modal">
                    <div class="modal-content">
                        <span class="close-btn" onclick="closeModal('edit-run-modal')">&times;</span>
                        <h2>Edit Run</h2>
                        <form id="edit-run-form" onsubmit="handleRunUpdate(event)">
                            <input type="hidden" id="edit-run-id"><input type="hidden" id="edit-course-id"><input type="hidden" id="edit-star-id">
                            <label for="edit-runner">Runner:</label><input type="text" id="edit-runner" required>
                            <label for="edit-time">Time:</label><input type="text" id="edit-time" required>
                            <label for="edit-date">Date:</label><input type="date" id="edit-date" required>
                            <label for="edit-videoLink">Video Link:</label><input type="url" id="edit-videoLink" required>
                            <button type="submit" id="update-run-button">Update Run</button>
                        </form>
                    </div>
                </div>
            `);

            updateModeratorUI(false);
            router();
        });
    </script>
</body>
</html>
