<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SM64 Mobile - Single Star Records</title>
    <style>
        :root {
            --bg-color: #1a1a1a;
            --text-color: #e0e0e0;
            --primary-color: #4CAF50; /* Green from the reference */
            --secondary-color: #b3b3b3;
            --border-color: #333;
            --header-bg: #2c2c2c;
            --table-header-bg: #003366; /* Dark blue from the reference */
            --table-row-bg: #222;
            --table-row-alt-bg: #282828;
        }
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
            margin: 0;
            padding: 1rem;
        }
        main { max-width: 1200px; margin: 0 auto; }
        .main-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        .main-header h1 {
            color: var(--primary-color);
            margin: 0;
            font-size: 2.5rem;
        }
        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 1rem 0;
        }
        .nav-tabs a {
            background-color: var(--header-bg);
            color: var(--text-color);
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
        }
        .nav-tabs a.active {
            background-color: var(--primary-color);
            color: white;
        }
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background-color: var(--header-bg);
            border-radius: 5px;
            margin-bottom: 2rem;
        }
        .submission-btn {
            background-color: var(--primary-color);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
            cursor: pointer;
        }
        .table-container { overflow-x: auto; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 2rem;
        }
        th, td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        thead th {
            background-color: var(--table-header-bg);
            color: white;
            font-size: 1.2rem;
        }
        tbody tr:nth-child(odd) { background-color: var(--table-row-bg); }
        tbody tr:nth-child(even) { background-color: var(--table-row-alt-bg); }
        tbody a {
            color: #8ab4f8; /* Light blue for links */
            text-decoration: none;
            font-weight: bold;
        }
        tbody a:hover { text-decoration: underline; color: var(--primary-color); }
        .breadcrumb { margin-bottom: 1rem; font-size: 1.1em; }
        .breadcrumb a { color: var(--secondary-color); }
        .breadcrumb span { color: var(--text-color); }
        .loader { text-align: center; font-size: 1.2em; padding: 2rem; }
        
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); justify-content: center; align-items: center; }
        .modal-content { background-color: #2a2a2a; padding: 2rem; border-radius: 8px; width: 90%; max-width: 500px; position: relative; }
        .close-btn { position: absolute; top: 10px; right: 15px; font-size: 1.5rem; cursor: pointer; }
        form input, form select, form button { width: 100%; padding: 0.75rem; margin-top: 0.5rem; border-radius: 4px; border: 1px solid var(--border-color); background-color: #333; color: var(--text-color); box-sizing: border-box; }
        form button { background-color: var(--primary-color); font-weight: bold; cursor: pointer; color: white; }
    </style>
</head>
<body>
    <div id="header-container"></div>
    <main id="app-container"></main>

    <!-- Modals -->
    <div id="submission-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('submission-modal')">&times;</span>
            <h2>Submit New Run</h2>
            <form id="submission-form" onsubmit="handleRunSubmission(event)">
                 <select id="course-select" required><option value="">Select a Course</option></select>
                <select id="star-select" required disabled><option value="">Select a Star</option></select>
                <input type="text" id="runner" required placeholder="Runner Name">
                <input type="text" id="igt" required placeholder="In-Game Time (IGT)">
                <input type="text" id="rta" placeholder="Real Time (RTA) (Optional)">
                <input type="date" id="date" required title="Date of the Run">
                <input type="url" id="videoLink" required placeholder="Video Link">
                <button type="submit">Submit Run</button>
            </form>
        </div>
    </div>
     <div id="login-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('login-modal')">&times;</span>
            <h2>Moderator Login</h2>
            <form id="login-form" onsubmit="handleLogin(event)">
                <label for="email">Email:</label>
                <input type="email" id="email" required>
                <label for="password">Password:</label>
                <input type="password" id="password" required>
                <button type="submit">Log In</button>
            </form>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

    <script>
        // ==============================================================================
        // --- 1. CONFIG & APP STATE ---
        // ==============================================================================
        const firebaseConfig = {
            apiKey: "AIzaSyCHGM4Bw4w-3SM3ScVCLnLhcCI0ISTB7S0",
            authDomain: "sm64-mobile-leaderboard.firebaseapp.com",
            projectId: "sm64-mobile-leaderboard",
            storageBucket: "sm64-mobile-leaderboard.firebasestorage.app",
            messagingSenderId: "474371344168",
            appId: "1:474371344168:web:a888b644a2a0b04ec9f21d"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        const appContainer = document.getElementById('app-container');
        const headerContainer = document.getElementById('header-container');

        const appState = {
            isModerator: false,
            coursesCache: [],
            starsCache: {},
            currentListener: null,
        };

        // ==============================================================================
        // --- 2. ROUTER & HELPERS ---
        // ==============================================================================
        function router() {
            if (appState.currentListener) appState.currentListener();
            const hash = window.location.hash || '#courses';
            
            renderHeader(hash);
            
            if (hash.startsWith('#courses')) {
                showCoursesPage();
            } else if (hash.startsWith('#star/')) {
                const [courseId, starId] = hash.substring('#star/'.length).split('/');
                showLeaderboardPage(courseId, starId);
            } else if (hash.startsWith('#minigames')) {
                showMinigamesPage();
            } else if (hash.startsWith('#wrhistory')) {
                showWRHistoryPage();
            } else {
                window.location.hash = '#courses';
            }
        }

        function renderLoader(message) { appContainer.innerHTML = `<div class="loader">${message}</div>`; }
        function renderError(message) { appContainer.innerHTML = `<h2>${message}</h2>`; }
        function parseTimeToNumeric(timeStr) {
            if (!timeStr) return Infinity;
            if (String(timeStr).includes(':')) {
                const parts = String(timeStr).split(':').map(Number);
                if (parts.length === 2) return (parts[0] * 60) + parts[1];
                if (parts.length === 3) return (parts[0] * 3600) + (parts[1] * 60) + parts[2];
            }
            return parseFloat(timeStr) || Infinity;
        }

        // ==============================================================================
        // --- 3. RENDER FUNCTIONS ---
        // ==============================================================================
        function renderHeader(currentHash) {
            headerContainer.innerHTML = `
                <header class="main-header">
                    <h1>Super Mario 64 Singlestar</h1>
                    <div class="nav-tabs">
                        <a href="#courses" class="${currentHash.startsWith('#course') || currentHash.startsWith('#star') ? 'active' : ''}">Singlestar</a>
                        <a href="#minigames" class="${currentHash.startsWith('#minigame') ? 'active' : ''}">Minigame</a>
                        <a href="#wrhistory" class="${currentHash.startsWith('#wrhistory') ? 'active' : ''}">WR History</a>
                    </div>
                </header>`;
        }

        async function showCoursesPage() {
            renderLoader("Loading Course Leaderboards...");
            await loadCourses();
            
            let contentHtml = `
                <div class="controls">
                    <a class="submission-btn" onclick="openSubmissionModal()">Submission</a>
                </div>`;

            for (const course of appState.coursesCache) {
                const stars = await loadStarsForCourse(course.id);
                let starRecordsHtml = '';

                for (const star of stars) {
                    const runsSnapshot = await db.collection('courses').doc(course.id).collection('stars').doc(star.id).collection('runs')
                        .where('status', '==', 'verified').orderBy('igt_numeric').limit(1).get();
                    
                    let wrHolder = { runner: '-', igt_str: '-', rta_str: '-', date: '-' };
                    if (!runsSnapshot.empty) {
                        wrHolder = runsSnapshot.docs[0].data();
                    }
                    
                    starRecordsHtml += `
                        <tr>
                            <td><a href="#star/${course.id}/${star.id}">${star.name}</a></td>
                            <td>${wrHolder.runner}</td>
                            <td>${wrHolder.rta_str || 'N/A'}</td>
                            <td>${wrHolder.igt_str || 'N/A'}</td>
                            <td>${wrHolder.date ? new Date(wrHolder.date.replace(/-/g, '\/')).toLocaleDateString() : '-'}</td>
                        </tr>
                    `;
                }
                
                contentHtml += `
                    <div class="table-container">
                        <table>
                            <thead><tr><th colspan="5">${course.order}. ${course.name}</th></tr></thead>
                            <tbody>
                                <tr>
                                    <td style="font-weight:bold; color: var(--secondary-color);">Star</td>
                                    <td style="font-weight:bold; color: var(--secondary-color);">Player</td>
                                    <td style="font-weight:bold; color: var(--secondary-color);">Real Time</td>
                                    <td style="font-weight:bold; color: var(--secondary-color);">IGT</td>
                                    <td style="font-weight:bold; color: var(--secondary-color);">Date</td>
                                </tr>
                                ${starRecordsHtml}
                            </tbody>
                        </table>
                    </div>
                `;
            }
            appContainer.innerHTML = contentHtml;
        }

        async function showLeaderboardPage(courseId, starId) {
            renderLoader("Loading Leaderboard...");
            await loadCourses();
            await loadStarsForCourse(courseId);
            const course = appState.coursesCache.find(c => c.id === courseId);
            const star = appState.starsCache[courseId]?.find(s => s.id === starId);

            if (!course || !star) { window.location.hash = '#courses'; return; }
            
            const runsRef = db.collection('courses').doc(courseId).collection('stars').doc(starId).collection('runs')
                .where('status', '==', 'verified').orderBy('igt_numeric');

            appState.currentListener = runsRef.onSnapshot(snapshot => {
                const runs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                appContainer.innerHTML = `
                    <div class="breadcrumb"><a href="#courses">Courses</a> / <span>${star.name}</span></div>
                    <h2>${star.name} - Leaderboard</h2>
                    <div class="table-container">
                        <table>
                            <thead><tr><th>#</th><th>Player</th><th>Real Time</th><th>IGT</th><th>Date</th><th>Platform</th></tr></thead>
                            <tbody>
                                ${runs.map((run, index) => `
                                    <tr>
                                        <td>${index + 1}</td>
                                        <td>${run.runner}</td>
                                        <td>${run.rta_str || 'N/A'}</td>
                                        <td>${run.igt_str || 'N/A'}</td>
                                        <td>${run.date ? new Date(run.date.replace(/-/g, '\/')).toLocaleDateString() : 'N/A'}</td>
                                        <td>N/A</td>
                                    </tr>
                                `).join('') || `<tr><td colspan="6">No runs for this star yet.</td></tr>`}
                            </tbody>
                        </table>
                    </div>
                `;
            });
        }
        
        function showMinigamesPage() {
            appContainer.innerHTML = "<h2>Minigames Page - Under Construction</h2>";
        }

        function showWRHistoryPage() {
            appContainer.innerHTML = "<h2>WR History Page - Under Construction</h2>";
        }
        
        // ==============================================================================
        // --- 4. ACTIONS & MODALS ---
        // ==============================================================================
        
        async function handleLogin(event) {
            event.preventDefault();
        }
        
        function openModal(modalId) { document.getElementById(modalId).style.display = 'flex'; }
        function closeModal(modalId) { document.getElementById(modalId).style.display = 'none'; }
        
        async function openSubmissionModal() {
            const courses = await loadCourses();
            const courseSelect = document.getElementById('course-select');
            const starSelect = document.getElementById('star-select');
            
            courseSelect.innerHTML = '<option value="">Select a Course</option>' + courses.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
            starSelect.innerHTML = '<option value="">Select a Star</option>';
            starSelect.disabled = true;

            courseSelect.onchange = async () => {
                const courseId = courseSelect.value;
                if (!courseId) {
                    starSelect.innerHTML = '<option value="">Select a Star</option>';
                    starSelect.disabled = true;
                    return;
                }
                const stars = await loadStarsForCourse(courseId);
                starSelect.innerHTML = '<option value="">Select a Star</option>' + stars.map(s => `<option value="${s.id}">${s.name}</option>`).join('');
                starSelect.disabled = false;
            };
            
            openModal('submission-modal');
        }

        async function handleRunSubmission(event) {
            event.preventDefault();
            // ... (Your existing submission logic)
        }
        
        // ==============================================================================
        // --- 5. DATA SEEDING (FOR INITIAL SETUP) ---
        // ==============================================================================
        async function seedDatabase() {
            console.log("Starting database seed. This will create the course structure.");
            if (!confirm("This will create the course and star structure if it doesn't exist. Continue?")) return;

            const coursesData = [
                { id: "bob", name: "Bob-omb Battlefield", order: 1, stars: [ { id: "big_bob_omb_on_the_summit", name: "Big Bob-omb on the Summit", order: 1 }, { id: "footrace_with_koopa_the_quick", name: "Footrace with Koopa the Quick", order: 2 }, { id: "shoot_to_the_island_in_the_sky", name: "Shoot to the Island in the Sky", order: 3 }, { id: "find_the_8_red_coins", name: "Find the 8 Red Coins", order: 4 }, { id: "mario_wings_to_the_sky", name: "Mario Wings to the Sky", order: 5 }, { id: "behind_chain_chomps_gate", name: "Behind Chain Chomp's Gate", order: 6 }, { id: "bob_100_coins", name: "Bob-omb Battlefield 100 Coins", order: 7 } ]},
                { id: "wf", name: "Whomp's Fortress", order: 2, stars: [ { id: "chip_off_whomps_block", name: "Chip off Whomp's Block", order: 1 }, { id: "to_the_top_of_the_fortress", name: "To the Top of the Fortress", order: 2 }, { id: "shoot_into_the_wild_blue", name: "Shoot into the Wild Blue", order: 3 }, { id: "red_coins_on_the_floating_isle", name: "Red Coins on the Floating Isle", order: 4 }, { id: "fall_onto_the_caged_island", name: "Fall onto the Caged Island", order: 5 }, { id: "blast_away_the_wall", name: "Blast Away the Wall", order: 6 }, { id: "wf_100_coins", name: "WF 100 Coins", order: 7 } ]},
                { id: "jrb", name: "Jolly Roger Bay", order: 3, stars: [ { id: "plunder_in_the_sunken_ship", name: "Plunder in the Sunken Ship", order: 1 }, { id: "can_the_eel_come_out_to_play", name: "Can the Eel Come out to Play?", order: 2 }, { id: "treasure_of_the_ocean_cave", name: "Treasure of the Ocean Cave", order: 3 }, { id: "red_coins_on_the_ship_afloat", name: "Red Coins on the Ship Afloat", order: 4 }, { id: "blast_to_the_stone_pillar", name: "Blast to the Stone Pillar", order: 5 }, { id: "through_the_jet_stream", name: "Through the Jet Stream", order: 6 }, { id: "jrb_100_coins", name: "JRB 100 Coins", order: 7 } ]},
                { id: "ccm", name: "Cool, Cool Mountain", order: 4, stars: [ { id: "slip_slidin_away", name: "Slip Slidin' Away", order: 1 }, { id: "lil_penguin_lost", name: "Li'l Penguin Lost", order: 2 }, { id: "big_penguin_race", name: "Big Penguin Race", order: 3 }, { id: "frosty_slide_for_8_red_coins", name: "Frosty Slide for 8 Red Coins", order: 4 }, { id: "snowmans_lost_his_head", name: "Snowman's Lost his Head", order: 5 }, { id: "wall_kicks_will_work", name: "Wall Kicks will Work", order: 6 }, { id: "ccm_100_coins", name: "CCM 100 Coins", order: 7 } ]},
                { id: "bbh", name: "Big Boo's Haunt", order: 5, stars: [ { id: "go_on_a_ghost_hunt", name: "Go on a Ghost Hunt", order: 1 }, { id: "ride_big_boos_merry_go_round", name: "Ride Big Boo's Merry-Go-Round", order: 2 }, { id: "secret_of_the_haunted_books", name: "Secret of the Haunted Books", order: 3 }, { id: "seek_the_8_red_coins", name: "Seek the 8 Red Coins", order: 4 }, { id: "big_boos_balcony", name: "Big Boo's Balcony", order: 5 }, { id: "eye_to_eye_in_the_secret_room", name: "Eye to Eye in the Secret Room", order: 6 }, { id: "bbh_100_coins", name: "BBH 100 Coins", order: 7 } ]},
                { id: "hmc", name: "Hazy Maze Cave", order: 6, stars: [ { id: "swimming_beast_in_the_cavern", name: "Swimming Beast in the Cavern", order: 1 }, { id: "elevate_for_8_red_coins", name: "Elevate for 8 Red Coins", order: 2 }, { id: "metal_head_mario_can_move", name: "Metal-Head Mario Can Move!", order: 3 }, { id: "navigating_the_toxic_maze", name: "Navigating the Toxic Maze", order: 4 }, { id: "a_maze_ing_emergency_exit", name: "A-Maze-ing Emergency Exit", order: 5 }, { id: "watch_for_rolling_rocks", name: "Watch for Rolling Rocks", order: 6 }, { id: "hmc_100_coins", name: "HMC 100 Coins", order: 7 } ]},
                { id: "lll", name: "Lethal Lava Land", order: 7, stars: [ { id: "boil_the_big_bully", name: "Boil the Big Bully", order: 1 }, { id: "bully_the_bullies", name: "Bully the Bullies", order: 2 }, { id: "8_coin_puzzle_with_15_pieces", name: "8-Coin Puzzle with 15 Pieces", order: 3 }, { id: "red_hot_log_rolling", name: "Red-Hot Log Rolling", order: 4 }, { id: "hot_foot_it_into_the_volcano", name: "Hot-Foot-It into the Volcano", order: 5 }, { id: "elevator_tour_in_the_volcano", name: "Elevator Tour in the Volcano", order: 6 }, { id: "lll_100_coins", name: "LLL 100 Coins", order: 7 } ]},
                { id: "ssl", name: "Shifting Sand Land", order: 8, stars: [ { id: "in_the_talons_of_the_big_bird", name: "In the Talons of the Big Bird", order: 1 }, { id: "shining_atop_the_pyramid", name: "Shining Atop the Pyramid", order: 2 }, { id: "inside_the_ancient_pyramid", name: "Inside the Ancient Pyramid", order: 3 }, { id: "stand_tall_on_the_four_pillars", name: "Stand Tall on the Four Pillars", order: 4 }, { id: "free_flying_for_8_red_coins", name: "Free Flying for 8 Red Coins", order: 5 }, { id: "pyramid_puzzle", name: "Pyramid Puzzle", order: 6 }, { id: "ssl_100_coins", name: "SSL 100 Coins", order: 7 } ]},
                { id: "ddd", name: "Dire, Dire Docks", order: 9, stars: [ { id: "board_bowsers_sub", name: "Board Bowser's Sub", order: 1 }, { id: "chests_in_the_current", name: "Chests in the Current", order: 2 }, { id: "pole_jumping_for_red_coins", name: "Pole-Jumping for Red Coins", order: 3 }, { id: "through_the_jet_stream_ddd", name: "Through the Jet Stream", order: 4 }, { id: "the_manta_rays_reward", name: "The Manta Ray's Reward", order: 5 }, { id: "collect_the_caps", name: "Collect the Caps", order: 6 }, { id: "ddd_100_coins", name: "DDD 100 Coins", order: 7 } ]},
                { id: "sl", name: "Snowman's Land", order: 10, stars: [ { id: "snowmans_big_head", name: "Snowman's Big Head", order: 1 }, { id: "chill_with_the_bully", name: "Chill with the Bully", order: 2 }, { id: "in_the_deep_freeze", name: "In the Deep Freeze", order: 3 }, { id: "whirl_from_the_freezing_pond", name: "Whirl from the Freezing Pond", order: 4 }, { id: "shell_shreddin_for_8_red_coins", name: "Shell Shreddin' for 8 Red Coins", order: 5 }, { id: "into_the_igloo", name: "Into the Igloo", order: 6 }, { id: "sl_100_coins", name: "SL 100 Coins", order: 7 } ]},
                { id: "wdw", name: "Wet-Dry World", order: 11, stars: [ { id: "shocking_arrow_lifts", name: "Shocking Arrow Lifts!", order: 1 }, { id: "top_o_the_town", name: "Top O' The Town", order: 2 }, { id: "secrets_in_the_shallows_and_sky", name: "Secrets in the Shallows & Sky", order: 3 }, { id: "express_elevators_hurry_up", name: "Express Elevators--Hurry Up!", order: 4 }, { id: "go_to_town_for_red_coins", name: "Go to Town for Red Coins", order: 5 }, { id: "quick_race_through_downtown", name: "Quick Race through Downtown", order: 6 }, { id: "wdw_100_coins", name: "WDW 100 Coins", order: 7 } ]},
                { id: "ttm", name: "Tall, Tall Mountain", order: 12, stars: [ { id: "scale_the_mountain", name: "Scale the Mountain", order: 1 }, { id: "mystery_of_the_monkey_cage", name: "Mystery of the Monkey Cage", order: 2 }, { id: "scary_shrooms_red_coins", name: "Scary 'Shrooms, Red Coins", order: 3 }, { id: "mysterious_mountainside", name: "Mysterious Mountainside", order: 4 }, { id: "breathtaking_view_from_bridge", name: "Breathtaking View from Bridge", order: 5 }, { id: "blast_to_the_lonely_mushroom", name: "Blast to the Lonely Mushroom", order: 6 }, { id: "ttm_100_coins", name: "TTM 100 Coins", order: 7 } ]},
                { id: "thi", name: "Tiny-Huge Island", order: 13, stars: [ { id: "pluck_the_piranha_flower", name: "Pluck the Piranha Flower", order: 1 }, { id: "the_tip_top_of_the_huge_island", name: "The Tip Top of the Huge Island", order: 2 }, { id: "rematch_with_koopa_the_quick", name: "Rematch with Koopa the Quick", order: 3 }, { id: "five_itty_bitty_secrets", name: "Five Itty Bitty Secrets", order: 4 }, { id: "wigglers_red_coins", name: "Wiggler's Red Coins", order: 5 }, { id: "make_wiggler_squirm", name: "Make Wiggler Squirm", order: 6 }, { id: "thi_100_coins", name: "THI 100 Coins", order: 7 } ]},
                { id: "ttc", name: "Tick Tock Clock", order: 14, stars: [ { id: "roll_into_the_cage", name: "Roll into the Cage", order: 1 }, { id: "the_pit_and_the_pendulums", name: "The Pit and the Pendulums", order: 2 }, { id: "get_a_hand", name: "Get a Hand", order: 3 }, { id: "stomp_on_the_thwomp", name: "Stomp on the Thwomp", order: 4 }, { id: "timed_jumps_on_moving_bars", name: "Timed Jumps on Moving Bars", order: 5 }, { id: "stop_time_for_red_coins", name: "Stop Time for Red Coins", order: 6 }, { id: "ttc_100_coins", name: "TTC 100 Coins", order: 7 } ]},
                { id: "rr", name: "Rainbow Ride", order: 15, stars: [ { id: "cruiser_crossing_the_rainbow", name: "Cruiser Crossing the Rainbow", order: 1 }, { id: "the_big_house_in_the_sky", name: "The Big House in the Sky", order: 2 }, { id: "coins_amassed_in_a_maze", name: "Coins Amassed in a Maze", order: 3 }, { id: "swingin_in_the_breeze", name: "Swingin' in the Breeze", order: 4 }, { id: "tricky_triangles", name: "Tricky Triangles!", order: 5 }, { id: "somewhere_over_the_rainbow", name: "Somewhere over the Rainbow", order: 6 }, { id: "rr_100_coins", name: "RR 100 Coins", order: 7 } ]},
                { id: "bowser_stages", name: "Bowser Stages", order: 16, stars: [ { id: "bowser_in_the_dark_world_no_reds", name: "Bowser in the Dark World No Reds", order: 1 }, { id: "bowser_in_the_dark_world_reds", name: "Bowser in the Dark World Reds", order: 2 }, { id: "bowser_in_the_fire_sea_no_reds", name: "Bowser in the Fire Sea No Reds", order: 3 }, { id: "bowser_in_the_fire_sea_reds", name: "Bowser in the Fire Sea Reds", order: 4 }, { id: "bowser_in_the_sky_no_reds", name: "Bowser in the Sky No Reds", order: 5 }, { id: "bowser_in_the_sky_reds", name: "Bowser in the Sky Reds", order: 6 } ]},
                { id: "secret_stars", name: "Castle Secret Stars", order: 17, stars: [ { id: "the_princesss_secret_slide", name: "The Princess's Secret Slide", order: 1 }, { id: "the_princesss_secret_slide_u21", name: "The Princess's Secret Slide U21", order: 2 }, { id: "the_secret_aquarium", name: "The Secret Aquarium", order: 3 }, { id: "tower_of_the_wing_cap", name: "Tower of the Wing Cap", order: 4 }, { id: "cavern_of_the_metal_cap", name: "Cavern of the Metal Cap", order: 5 }, { id: "vanish_cap_under_the_moat", name: "Vanish Cap Under the Moat", order: 6 }, { id: "wing_mario_over_the_rainbow", name: "Wing Mario Over the Rainbow", order: 7 } ]}
            ];

            const batch = db.batch();
            coursesData.forEach(course => {
                const courseRef = db.collection('courses').doc(course.id);
                batch.set(courseRef, { name: course.name, order: course.order });
                course.stars.forEach(star => {
                    const starRef = courseRef.collection('stars').doc(star.id);
                    batch.set(starRef, { name: star.name, order: star.order });
                });
            });

            try {
                await batch.commit();
                alert("Database structure seeded successfully!");
                window.location.reload();
            } catch (error) {
                console.error("Seeding failed:", error);
                alert("Seeding failed. Check the console and Firestore rules.");
            }
        }
        
        // ==============================================================================
        // --- 6. INITIALIZATION ---
        // ==============================================================================
        window.addEventListener('hashchange', router);
        document.addEventListener('DOMContentLoaded', router);
    </script>
</body>
</html>
